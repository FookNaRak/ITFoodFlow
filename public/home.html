<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IT's FOOD</title>
    <link rel="stylesheet" href="/css/homestyles.css" />
  </head>
  <body>
    <div class="main-container">
      <header class="header">
        <div class="header-content">
          <h1 class="logo">IT's FOOD</h1>
        </div>
        <div class="logout-container">
          <a href="home.html" class="logout">Log out</a>
        </div>
      </header>

      <main class="main-content">
        <!-- Tracking Section -->
        <section class="tracking">
          <h2>Tracking</h2>
          <div class="tracking-box" id="open-tracking">Tracking</div>
        </section>

        <!-- Shops Section -->
        <section class="shops">
          <h2>Shops</h2>
          <div id="shop-grid" class="shop-grid">
            <!-- Shops will be displayed here -->
          </div>
        </section>
      </main>
    </div>

    <!-- Modal for tracking -->
    <div id="tracking-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Tracking</h2>
        <div id="tracking-container" class="tracking-item">
          <!-- Tracking items will be dynamically added here -->
        </div>
      </div>
    </div>

    <!-- JavaScript to handle shop and tracking functionalities -->
    <script>
      class Shop {
        #shopGrid;

        constructor(shopGridId) {
          this.#shopGrid = document.getElementById(shopGridId);
        }

        // Public method to fetch shops
        fetchShops() {
          fetch("/api/shops")
            .then((response) => response.json())
            .then((data) => this.#renderShops(data))
            .catch((error) => {
              console.error("Error fetching shops:", error);
            });
        }

        // Private method to render shops
        #renderShops(shops) {
          shops.forEach((shop) => {
            const shopItem = document.createElement("div");
            shopItem.className = "shop-item";
            shopItem.innerHTML = `
                        <a href="http://localhost:5000/restaurant" class="shop-link">
                            <p>${shop.shopName}</p>
                            <p>Location: ${shop.location || "Not specified"}</p>
                        </a>
                    `;
            this.#shopGrid.appendChild(shopItem);
          });
        }

        // Getter for the shopGrid (read-only)
        get shopGrid() {
          return this.#shopGrid;
        }
      }

      class TrackingModal {
        #modal;
        #openBtn;
        #closeBtn;
        #trackingContainer;

        constructor(modalId, openBtnId, closeBtnClass, trackingContainerId) {
          this.#modal = document.getElementById(modalId);
          this.#openBtn = document.getElementById(openBtnId);
          this.#closeBtn = document.getElementsByClassName(closeBtnClass)[0];
          this.#trackingContainer =
            document.getElementById(trackingContainerId);
          this.#initializeEvents();
        }

        // Private method to initialize events
        #initializeEvents() {
          this.#openBtn.onclick = () => this.#openModal();
          this.#closeBtn.onclick = () => this.#closeModal();
          window.onclick = (event) => {
            if (event.target == this.#modal) {
              this.#closeModal();
            }
          };
        }

        // Private method to open modal
        #openModal() {
          this.#modal.style.display = "block";
          this.fetchTrackingData(); // Fetch tracking data when the modal opens
        }

        // Private method to close modal
        #closeModal() {
          this.#modal.style.display = "none";
        }

        // Fetch tracking data from the server
        fetchTrackingData() {
          const userID = 1; // Replace with the actual userID

          fetch(`/api/tracking/${userID}`)
            .then((response) => response.json())
            .then((data) => {
              console.log(data); // Debugging: Check what data is received
              this.#renderTrackingData(data);
            })
            .catch((error) => {
              console.error("Error fetching tracking data:", error);
            });
        }

        #renderTrackingData(orders) {
          // Ensure that orders is an array
          if (!Array.isArray(orders)) {
            console.error("Tracking data is not an array:", orders);
            return;
          }

          this.#trackingContainer.innerHTML = ""; // Clear the container first

          orders.forEach((order) => {
            const statusText =
              order.status === "completed"
                ? "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"
                : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${order.queue} ‡∏Ñ‡∏¥‡∏ß`;
            const statusClass = order.status === "completed" ? "success" : "";

            const orderItem = `
            <div class="tracking-detail">
                <img src="path/to/image" alt="item image">
                <div class="item-info">
                    <p>${order.menuItem}</p>
                    <p>${order.price} ‡∏ø</p>
                </div>
                <div class="item-status ${statusClass}">
                    <p>${statusText}</p>
                    <button class="delete-btn">üóëÔ∏è</button>
                </div>
            </div>
        `;
            this.#trackingContainer.innerHTML += orderItem;
          });
        }

        get isModalOpen() {
          return this.#modal.style.display === "block";
        }

        set modalVisible(isVisible) {
          this.#modal.style.display = isVisible ? "block" : "none";
        }
      }

      // Initialize the classes when the DOM is fully loaded
      document.addEventListener("DOMContentLoaded", () => {
        const shopInstance = new Shop("shop-grid");
        shopInstance.fetchShops();

        const trackingModalInstance = new TrackingModal(
          "tracking-modal",
          "open-tracking",
          "close-btn",
          "tracking-container"
        );

        // Example of using the setter to open the modal
        trackingModalInstance.modalVisible = false;

        // Example of using the getter to check if the modal is open
        console.log(trackingModalInstance.isModalOpen);
      });
    </script>
  </body>
</html>
